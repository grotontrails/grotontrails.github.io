<!--?xml version="1.0" encoding="UTF-8"?-->
<html>

<head>
    <title>Groton Trails</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
    <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.css' rel='stylesheet' />
    <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>
    <script src="http://cdn-geoweb.s3.amazonaws.com/esri-leaflet/0.0.1-beta.5/esri-leaflet.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.js'></script>
	
    <!--[if lt IE 9]>
      <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.21.0/L.Control.Locate.ie.css' rel='stylesheet' />
    <![endif]-->
    <style> 
      html, body, #map { height:100%; padding:0; margin:0 } 
      .leaflet-control-scale-line {margin-left:80px;}
      .leaflet-top {margin-top:63px;}
    </style>	
</head>
<body>

  <div id="map">
  <div class="cartodb-header" style="display: block;">
    <div class="content">
      <div class="title" style="display: block;">Groton Trails Network</div>
      <div class="description" style="display: block;margin-right:50px"><p>Please be advised that the material posted on this website is for informational purposes only.</p>
      </div>
            <div style="float:right;margin-right:-20px;margin-top:-40px"><a href="http://www.grotontrails.org/"><img width="60%" src="images/GTN.png"></a></div>
    </div>
  </div> -->
  </div><!-- end of map -->

  
	<script id="pointsCSS" type="text/mapcss">

	// 1 private
	// 2 campground
	// 3 general POI
	// 4 swimming
	// 5 parking
	// 6 trailhead
	// 7 trail access
	// 8 wet
	// 9 poi, castle

	// main area label
	#points[symbolid=0] {
	   marker-width: 20;  
	   marker-file: url(http://www.grotontrails.org/digital_maps/map_icons/marker-24.svg);
	   marker-fill-opacity:1;
	   marker-fill: #055D00;
	   marker-line-width: 1.5;
	   marker-line-color: #FFFFFF;
	   marker-line-opacity: 1;
	   marker-placement: point;
	   marker-allow-overlap: true;
	}

	// private
	#points[symbolid=1][zoom>14] {
	   marker-width: 13;  
	   marker-fill: #FF0000;  
	   marker-file: url(http://www.grotontrails.org/digital_maps/map_icons/marker-24.svg);
	}

	// swimming
	#points[symbolid=4][zoom>14] {
	   marker-width: 25;  
	   marker-fill: #A53ED5;
	   marker-file:
		 url(http://www.grotontrails.org/digital_maps/map_icons/swimming-24.svg);
	}

	// wet
	#points[symbolid=5][zoom>14] {
	   marker-width: 35;  
	   marker-fill: #000000;
	   marker-file:
		 url(http://www.grotontrails.org/digital_maps/map_icons/parking-24.svg);
	   //marker-fill: #2E5387;
	}

	// trail head
	#points[symbolid=6][zoom>14] {
	   marker-width: 8; 
	}

	// trail access
	#points[symbolid=7][zoom>14] {
	   marker-width: 7;  
	}

	// private
	#points[symbolid=8][zoom>14] {
	   marker-width: 18;  
	   marker-fill: #5CA2D1;  
	   marker-file: url(http://www.grotontrails.org/digital_maps/map_icons/water-24.svg);
	}


	// everything else
	#points[symbolid!=0][symbolid!=1][symbolid!=4][symbolid!=5][symbolid!=6][symbolid!=7][symbolid!=8][zoom>14] {
	   marker-fill-opacity: 1;
	   marker-line-width: 1.5;
	   marker-line-opacity: 1;
	   marker-placement: point;
	   marker-type: ellipse;
	   marker-allow-overlap: true;
	   marker-width: 4;  
	}
	</script>

	<script id="lineCSS" type="text/mapcss">

	#grotontrails_detail_map{
	  line-color: #055D00;
	  line-width: 2;
	  line-opacity: 0.7;
	  
	  [zoom<14] { line-width:1 }
	}

	#grotontrails_detail_map[trail_type = 'sidewalk']{
	  line-color:#523A00;
	  line-opacity: 0.7;
	  line-width: 2;  
	  line-dasharray: 5,5;
	  [zoom<14] { line-width:1 }
	}

	#grotontrails_detail_map[trail_type = 'bike']{
	  line-color: #0000ff;
	  line-width: 1;
	}

	#grotontrails_detail_map[zoom>14]{
	 text-name: [name];
	 text-size: 10;
	 text-face-name:'Open Sans Regular';
	 text-fill: #000000;
	 text-halo-radius: 1;
	 text-dy: 12;
	 text-placement: line;
	}	
	</script>

  
    <!-- include cartodb.js library -->
    <script>

      function main() {

        var mapbox = L.tileLayer('http://a.tiles.mapbox.com/v3/davidpitkin.map-3v8obosa/{z}/{x}/{y}.png', {attribution: 'Mapbox'}),
            mapbox2 = L.tileLayer('http://a.tiles.mapbox.com/v3/davidpitkin.k1fka0cj/{z}/{x}/{y}.png', {attribution: 'Mapbox'}),
            mapbox3 = L.tileLayer('http://a.tiles.mapbox.com/v3/davidpitkin.kqql4n29/{z}/{x}/{y}.png', {attribution: 'Mapbox'}),
            esri = L.esri.basemapLayer('Topographic');

        // create leaflet map
        var map = L.map('map', { 
          zoomControl: true,
          center: [42.608, -71.572],
          zoom: 13,
          layers: [mapbox3]
          
        });

        map.addControl(L.control.locate({
          locateOptions: { maxZoom: 15 }
          })
        );

        var baseMaps = {
          "Mapbox" : mapbox,
          "Satelite" : mapbox2,
          "Outdoors" : mapbox3,
          "Topographic" : esri
        };
		
        L.control.layers(baseMaps).addTo(map);
        L.control.scale().addTo(map);

        // add cartodb layer
        /*cartodb.createLayer(map, 'http://grotontrails.cartodb.com/api/v2/viz/08dd6f9a-401c-11e4-aecc-0e73339ffa50/viz.json')
          .addTo(map)
          .on('done', function(layer) {
            layer.setZIndex(5);
          });
		*/
		
        cartodb.createLayer(map, 'http://grotontrails.cartodb.com/api/v2/viz/3807c3ee-893a-11e4-af6e-0e853d047bba/viz.json', function(layer) {
		 
          var trailSubLayer = layer.createSubLayer({
            sql: 'SELECT * FROM grotontrails_detail_map',
			cartocss: '#grotontrails_detail_map { line-color: blue; }'
            });
		  trailSubLayer.setCartoCSS(document.getElementById("lineCSS").innerHTML)
		     
          var poiSubLayer = layer.createSubLayer({
            sql: 'SELECT * FROM points',
			cartocss: '#points { marker-fill: red;marker-type: ellipse; marker-width: 10;}'
			});
		  poiSubLayer.setInteraction(true)
	      poiSubLayer.setCartoCSS(document.getElementById("pointsCSS").innerHTML)
		  
        }).addTo(map)
        .on('done', function(layer) {
          layer.setZIndex(5);
        });		
      }
 
      window.onload = main;
    </script>
</body>

</html>
