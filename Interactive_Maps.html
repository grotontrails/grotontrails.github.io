<!--?xml version="1.0" encoding="UTF-8"?-->
<html lang="en">

<head>
    <Title>Groton Trails Map </Title>
    <link href="https://fonts.googleapis.com/css?family=Neucha|Open+Sans" rel="stylesheet">
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    
	<script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
	<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />

    <link rel="stylesheet" href="style.css" />

	<script src="points.js"></script>
	<script src="photos.js"></script>

    <style>	
    #map {		
		height: 93%;				
        margin: 0;
	}
    </style>    

</head>

<html>
<body>
	<div class="page">
		<header role="banner">
			<nav>
				<a href="Welcome.html"> Trails</a>
				<a href="get_involved.html"> Get Involved</a>
				<a class="current" href="Interactive_Maps.html"> Map</a>
				<a href="printed_maps.html"> Printable Maps</a>
				<a href="about.html"> About Us</a>
			</nav>
		</header>
		<div id="map">
		</div>
</body>

<script>
function main() {

    var mapboxAttrib = 'For informational purposes only.<br> &copy; <a href="http://www.mapbox.com/">Mapbox</a> &copy;, <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'

    var mapboxSatellite = L.tileLayer('https://api.tiles.mapbox.com/v4/mapbox.streets-satellite/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoianJlbWlsbGFyZCIsImEiOiJzX2dhaXN3In0.qWyAnddfUVfs61ojApFvsg', {
        attribution: mapboxAttrib
    });
    var mapboxOutdoors = L.tileLayer('https://api.tiles.mapbox.com/v4/jremillard.6095d11a/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoianJlbWlsbGFyZCIsImEiOiJzX2dhaXN3In0.qWyAnddfUVfs61ojApFvsg', {
        attribution: mapboxAttrib
    });
 
    // create leaflet map
    var map = L.map('map', {
        zoomControl: true,
        center: [42.608, -71.572],
        zoom: 13        
    });

	var cameraIconObj = L.icon({ iconUrl: 'images/camera-4-16.png', iconSize: [16,16]})

	var photoMarkers = []
	for (var i = 0; i < photoData.features.length; ++i) {
		var markerElementData =  photoData.features[i]
		var marker = L.marker(markerElementData.geometry.coordinates.reverse(),{icon: cameraIconObj })
		marker.bindPopup("<a href=\"" +  markerElementData.properties.url + "\"> <img width=\"175\" height=\"175\" src=\"" + markerElementData.properties.url + "\" > </a>");
		photoMarkers.push( marker)
	}

	var photosLayerGroup = L.layerGroup(photoMarkers);
			
    // set basemaps
    var baseMaps = {
        "Map": mapboxOutdoors,
        "Satellite": mapboxSatellite
    };
	var layerOptions = { 
		"Photos" : photosLayerGroup
	};

    L.control.layers(baseMaps,layerOptions).addTo(map);

    L.control.scale().addTo(map);
	//L.control.locate().addTo(map);

    mapboxOutdoors.addTo(map);
	
    //var parkingIconObj = L.icon({ iconUrl: 'images/parking.png',iconSize: [16,16] } )
	var smallDropIconObj = L.icon({ iconUrl: 'images/small-drop-marker.png', iconSize: [16,16]})

	for (var i = 0; i < markerData.features.length; ++i) {
		var markerElementData =  markerData.features[i]
		var marker = L.marker(markerElementData.geometry.coordinates.reverse(),{title: markerElementData.properties.name, icon: smallDropIconObj })
		markerElementData.marker = marker

        // markerElementData.properties.symbolid
		// 0 property name
		// 1 private
		// 2 campground
		// 3 general POI
		// 4 swimming
		// 5 parking
		// 6 trailhead
		// 7 trail access
		// 8 wet
		// 9 poi, castle

		if ( markerElementData.properties.symbolid == 5 || markerElementData.properties.symbolid == 7) {

			var parkingArray = markerElementData.geometry.coordinates;

			var googleURL = "https://maps.google.com/?daddr=" + parkingArray[0].toString() + "," + parkingArray[1].toString();
			var iosURL = "https://maps.apple.com/?daddr=" + parkingArray[0].toString() + "," + parkingArray[1].toString();
			var bingURL = "https://bing.com/maps/default.aspx?rtp=~adr." + parkingArray[0].toString() + "," + parkingArray[1].toString();
			var osmURL = "https://www.openstreetmap.org/#map=18/" + parkingArray[0].toString() + "/" + parkingArray[1].toString();

			var directionsHTML = 
			"<br>Directions: " + 
			"<a href=\"" + googleURL + "\">Google</a>, " +
			"<a href=\"" + iosURL + "\">Apple</a>, " +
			"<a href=\"" + bingURL + "\">Bing</a>, " + 
			"<a href=\"" + osmURL + "\">OSM</a>";

			var iOS = ['iPad', 'iPhone', 'iPod'].indexOf(navigator.platform) >= 0;			
			if ( iOS) {
				directionsHTML = "<br><a href=\"" + iosURL + "\">Directions to Here</a>"
			}
			var android = ['Android'].indexOf(navigator.platform) >= 0;
			if ( android) {
				directionsHTML = "<br><a href=\"" + googleURL + "\">Directions to Here</a>"
			}

			markerElementData.properties.popupinfo += directionsHTML; 
		}

		if ( markerElementData.properties.popupinfo.length > 0 ) {
			marker.bindPopup(markerElementData.properties.popupinfo)
		}
	}

	function updateMarkers() {
		var zoom = map.getZoom()

		for (var i = 0; i < markerData.features.length; ++i) {
			var markerElementData =  markerData.features[i]
			var minZoom = 14;

			if ( markerElementData.properties.symbolid == 0) {
				minZoom = 10;
			}

			if ( zoom > minZoom ) {
				map.addLayer( markerElementData.marker)
			} else {
				map.removeLayer( markerElementData.marker )
			}
		}
	}
		
	function updateURL() {
	  var pos = map.getCenter();
	  var newFragment = "#map=" + map.getZoom() + "/" + pos.lat.toPrecision(7) + "/" + pos.lng.toPrecision(7);
	  history.replaceState({},'',newFragment);
	}
	
    if ( location && location.hash.indexOf("#map=") == 0 ) {
	  var url = location.hash.slice(5);
	  var ll = url.split('/');
	  map.panTo( [ll[1],ll[2]] );
	  map.setZoom(ll[0]); 		
	} else {
      var pos = map.getCenter();
	  var newFragment = "#map=" + map.getZoom() + "/" + pos.lat.toPrecision(7) + "/" + pos.lng.toPrecision(7);
	  history.replaceState({},'',newFragment);
	}
			
	map.on('moveend', updateURL );
    map.on('zoomend', updateURL );
	map.on('zoomend', updateMarkers);

	updateMarkers();
	    					
    // remove leaflet attribution
    map.attributionControl.setPrefix('')
}

window.onload = main;
</script>

</html>

